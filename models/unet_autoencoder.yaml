# U-Net Style Autoencoder with Skip Connections
# Uses cross-section references to connect encoder layers to decoder
model_name: UNetAutoencoder
input_shape: [3, 256, 256]

encoder:
  # Structure: [input_from, num_repeats, layer_type, layer_args]
  - [-1, 1, Conv, [64, 3, 1, 1]]       # E0: 256x256x64
  - [-1, 1, BatchNorm, []]
  - [-1, 1, ReLU, []]
  - [-1, 1, Conv, [64, 3, 1, 1]]       # E3: 256x256x64 (skip connection point)
  - [-1, 1, BatchNorm, []]
  - [-1, 1, ReLU, []]

  - [-1, 1, MaxPool, [2, 2]]            # E6: 128x128x64
  - [-1, 1, Conv, [128, 3, 1, 1]]      # E7: 128x128x128
  - [-1, 1, BatchNorm, []]
  - [-1, 1, ReLU, []]
  - [-1, 1, Conv, [128, 3, 1, 1]]      # E10: 128x128x128 (skip connection point)
  - [-1, 1, BatchNorm, []]
  - [-1, 1, ReLU, []]

  - [-1, 1, MaxPool, [2, 2]]            # E13: 64x64x128
  - [-1, 1, Conv, [256, 3, 1, 1]]      # E14: 64x64x256
  - [-1, 1, BatchNorm, []]
  - [-1, 1, ReLU, []]

decoder:
  - [-1, 1, Upsample, [None, 2, "bilinear"]]  # D0: 128x128x256
  - [-1, 1, Conv, [128, 3, 1, 1]]             # D1: 128x128x128
  - [-1, 1, BatchNorm, []]
  - [-1, 1, ReLU, []]
  - [['encoder:10', -1], 1, Concat, [1]]      # D4: Skip from E10 -> 128x128x256
  - [-1, 1, Conv, [128, 3, 1, 1]]             # D5: 128x128x128
  - [-1, 1, BatchNorm, []]
  - [-1, 1, ReLU, []]

  - [-1, 1, Upsample, [None, 2, "bilinear"]]  # D8: 256x256x128
  - [-1, 1, Conv, [64, 3, 1, 1]]              # D9: 256x256x64
  - [-1, 1, BatchNorm, []]
  - [-1, 1, ReLU, []]
  - [['encoder:3', -1], 1, Concat, [1]]       # D12: Skip from E3 -> 256x256x128
  - [-1, 1, Conv, [64, 3, 1, 1]]              # D13: 256x256x64
  - [-1, 1, BatchNorm, []]
  - [-1, 1, ReLU, []]

  - [-1, 1, Conv, [3, 3, 1, 1]]               # D16: Final reconstruction 256x256x3
  - [-1, 1, Sigmoid, []]                      # D17: Output in [0, 1] range
